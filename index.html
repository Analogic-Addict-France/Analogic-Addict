<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analogic Addict France - Accueil</title>
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            --primary: #6C516C;
            --bg: #1B1B1B;
            --text: #f4f4f4;
            --card-bg: #252525;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
        }

        /* Nav Responsive */
        nav {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 10px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--primary);
        }

        .nav-container {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
        }

        .logo img { height: 35px; width: auto; }

        .nav-links { display: flex; gap: 15px; }
        .nav-links a { color: white; text-decoration: none; font-size: 0.9em; }

        .container { max-width: 1100px; margin: auto; padding: 15px; }

        /* Bouton Wiki */
        .wiki-btn {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, var(--primary), #4a384a);
            padding: 15px;
            border-radius: 10px;
            text-decoration: none;
            color: white;
            font-weight: bold;
            margin-bottom: 20px;
        }

        /* Grille Principale (PC vs Mobile) */
        .home-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }

        /* Layout de la carte Musique */
        .music-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid var(--primary);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Organisation Image/Texte sur PC */
        .music-content-wrapper {
            display: flex;
            flex-direction: row; /* Image gauche, texte droite */
            gap: 20px;
        }

        .music-img {
            width: 40%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 10px;
        }

        .music-info {
            width: 60%;
        }

        .playing-animation {
            display: inline-flex;
            gap: 3px;
            height: 15px;
            margin-left: 10px;
        }
        .bar { width: 3px; background: var(--primary); animation: bounce 1s infinite; }

        @keyframes bounce { 0%, 100% { height: 5px; } 50% { height: 15px; } }

        .btn {
            background: var(--primary);
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-decoration: none;
            display: block;
            text-align: center;
            font-weight: bold;
            border: none;
            width: 100%;
            margin-top: 10px;
            cursor: pointer;
        }

        /* RESPONSIVE TELEPHONE */
        @media (max-width: 850px) {
            .home-grid { grid-template-columns: 1fr; } /* Discord passe en dessous */
            
            .music-content-wrapper {
                flex-direction: column; /* Image dessus, texte dessous */
            }

            .music-img { width: 100%; }
            .music-info { width: 100%; }

            .discord-widget iframe { width: 100%; }
        }
    </style>
</head>
<body>

<nav>
    <div class="nav-container">
        <a href="index.html" class="logo"><img src="img/logo.png" alt="Logo"></a>
        <div class="nav-links">
            <a href="index.html">Accueil</a>
            <a href="generator.html">G√©n√©rateur</a>
            <a href="wiki.html">Wiki</a>
        </div>
    </div>
</nav>

<div id="youtube-player"></div>

<div class="container">
    <a href="wiki.html" class="wiki-btn">
        <span>EXPLORER LE WIKI</span>
        <span>‚Üí</span>
    </a>

    <div class="home-grid">
        <div id="music-section">
            <div id="music-container" class="music-card">
                </div>
            <button class="btn" onclick="copyDiscordFormat()" style="background:#333;">üìã Copier pour Discord</button>
        </div>

        <div class="discord-widget">
            <iframe src="https://discord.com/widget?id=1183880368173096983&theme=dark" width="100%" height="500" allowtransparency="true" frameborder="0" sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>
        </div>
    </div>
</div>

<script>
    let player;
    let musicData = {};

    fetch('data.json')
        .then(r => r.json())
        .then(data => {
            musicData = data;
            // S√©curit√© pour √©viter les "undefined"
            const title = data.titre || "Titre inconnu";
            const artist = data.artiste || "Artiste inconnu";
            const album = data.album || "Album";
            const genre = data.genre || "Non d√©fini";

            document.getElementById('music-container').innerHTML = `
                <h2 style="margin:0 0 10px 0;">${title} 
                    <div class="playing-animation"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
                </h2>
                <div class="music-content-wrapper">
                    <img src="${data.image}" class="music-img">
                    <div class="music-info">
                        <p style="color:var(--primary); font-weight:bold; margin:0;">${artist} ‚Äî ${album}</p>
                        <p style="font-size:0.9em; margin:10px 0;">
                            <strong>Genre :</strong> ${genre}<br>
                            <strong>Langue :</strong> ${data.langue || 'Fran√ßais'}<br>
                            <strong>Date :</strong> ${data.date || 'Inconnue'}
                        </p>
                        <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:8px; font-size:0.85em;">
                            ${data.histoire || 'Pas d\'histoire enregistr√©e.'}
                        </div>
                    </div>
                </div>
            `;

            const videoId = data.url?.split('v=')[1]?.split('&')[0];
            if(videoId) initYouTubeAPI(videoId);
        });

    function initYouTubeAPI(vId) {
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.head.appendChild(tag);
        window.onYouTubeIframeAPIReady = () => {
            player = new YT.Player('youtube-player', {
                height: '0', width: '0', videoId: vId,
                playerVars: { 'autoplay': 1, 'loop': 1, 'playlist': vId },
                events: { 'onReady': (e) => {
                    e.target.setVolume(0);
                    document.body.addEventListener('click', () => {
                        e.target.playVideo();
                        let v = 0;
                        let i = setInterval(() => { if(v<20){v++; e.target.setVolume(v);} else clearInterval(i); }, 150);
                    }, {once:true});
                }}
            });
        };
    }

    function copyDiscordFormat() {
        const text = `<@&1342094598822166588> \n\n# MUSIQUE DU JOUR\n- **Titre** : ${musicData.titre}\n- **Artiste** : ${musicData.artiste}\n- **Album** : ${musicData.album}\n- **Lien** : ${musicData.url}`;
        navigator.clipboard.writeText(text).then(() => alert("Copi√© !"));
    }
</script>
</body>
</html>
