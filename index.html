<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    
    <title>Analogic Addict France - Accueil</title>
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            --primary: #6C516C;
            --bg: #1B1B1B;
            --text: #f4f4f4;
            --card-bg: #252525;
            --discord-blurple: #5865F2;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0; padding: 0;
        }

        nav {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 10px 0;
            position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid var(--primary);
        }

        .nav-container {
            max-width: 1100px; margin: 0 auto;
            display: flex; justify-content: space-between; align-items: center; padding: 0 15px;
        }

        .logo img { height: 35px; width: auto; }
        .nav-links { display: flex; gap: 15px; }
        .nav-links a { color: white; text-decoration: none; font-size: 0.9em; font-weight: bold; }

        .container { max-width: 1100px; margin: auto; padding: 15px; }

        .wiki-btn {
            display: flex; justify-content: space-between; align-items: center;
            background: linear-gradient(90deg, var(--primary), #4a384a);
            padding: 15px; border-radius: 10px; text-decoration: none;
            color: white; font-weight: bold; margin-bottom: 20px; transition: 0.3s;
        }

        .home-grid {
            display: grid; grid-template-columns: 1fr 350px; gap: 20px;
        }

        .music-card {
            background: var(--card-bg); border-radius: 15px; padding: 20px;
            border-left: 5px solid var(--primary); display: flex; flex-direction: column; gap: 15px;
        }

        .music-content-wrapper {
            display: flex; flex-direction: row; gap: 20px; align-items: start;
        }

        .music-img {
            width: 35%; aspect-ratio: 1 / 1; object-fit: cover; border-radius: 10px; background: #111;
        }

        .music-info { width: 65%; }

        .playing-animation {
            display: inline-flex; gap: 3px; height: 15px; margin-left: 10px;
        }
        .bar { width: 3px; background: var(--primary); animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { height: 5px; } 50% { height: 15px; } }

        .action-buttons {
            display: flex; flex-direction: column; gap: 12px; margin-top: 15px;
        }

        .btn {
            border-radius: 10px; text-decoration: none; display: block;
            text-align: center; font-weight: bold; border: none;
            cursor: pointer; transition: 0.3s; font-size: 1.1em;
        }

        .btn-discord {
            background-color: var(--discord-blurple);
            color: white;
            padding: 22px;
            box-shadow: 0 4px 15px rgba(88, 101, 242, 0.2);
        }
        .btn-discord:hover { background-color: #4752c4; transform: scale(1.01); }

        .btn-copy {
            background-color: #333;
            color: white;
            padding: 14px;
            border: 1px solid var(--primary);
            font-size: 0.9em;
            opacity: 0.8;
        }
        .btn-copy:hover { opacity: 1; background: #444; }

        @media (max-width: 850px) {
            .home-grid { grid-template-columns: 1fr; }
            .music-content-wrapper { flex-direction: column; }
            .music-img { width: 100%; max-width: 300px; margin: 0 auto; }
            .music-info { width: 100%; text-align: center; }
        }
        /* Style pour l'histoire dÃ©pliable */
.history-wrapper {
    position: relative;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    margin-top: 10px;
    overflow: hidden;
}

#music-history {
    padding: 12px;
    font-size: 0.85em;
    line-height: 1.4;
    max-height: 80px; 
    transition: max-height 0.4s ease-out;
    overflow: hidden;
    
    /* CORRECTIONS ALIGNEMENT ET DÃ‰BORDEMENT */
    text-align: left;          /* Le texte commence bien Ã  gauche */
    white-space: pre-wrap;     /* Garde tes sauts de ligne du JSON */
    overflow-wrap: break-word; /* Coupe les mots trop longs si besoin */
}

#music-history.expanded {
    max-height: 1000px; /* Hauteur max quand c'est dÃ©pliÃ© */
}

.toggle-history {
    width: 100%;
    background: rgba(255, 255, 255, 0.05);
    border: none;
    color: var(--primary);
    font-size: 0.8em;
    font-weight: bold;
    padding: 5px;
    cursor: pointer;
    text-transform: uppercase;
}

.toggle-history:hover {
    background: rgba(255, 255, 255, 0.1);
}
    </style>
</head>
<body>

<nav>
    <div class="nav-container">
        <a href="index.html" class="logo"><img src="img/logo.png" alt="Logo"></a>
        <div class="nav-links">
            <a href="index.html">Accueil</a>
            <a href="generator.html">GÃ©nÃ©rateur</a>
            <a href="wiki.html">Wiki</a>
        </div>
    </div>
</nav>

<div class="container">
    <a href="wiki.html" class="wiki-btn">
        <span>EXPLORER LE WIKI</span>
        <span>â†’</span>
    </a>

    <div class="home-grid">
        <div id="music-section">
            <div id="music-container" class="music-card">
                </div>
            
            <div class="action-buttons">
                <button class="btn btn-copy" onclick="copyDiscordFormat()">
                    ðŸ“‹ Copier le format pour Discord
                </button>
                <a href="TON_LIEN_DINVITATION" target="_blank" class="btn btn-discord">
                    âœ¨ Rejoindre le serveur Discord !
                </a>
            </div>
        </div>

        <div class="discord-widget">
            <iframe src="https://discord.com/widget?id=1183880368173096983&theme=dark" width="100%" height="520" allowtransparency="true" frameborder="0" sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"></iframe>
        </div>
    </div>
</div>

<script>
    let musicData = {};

    fetch('data.json')
        .then(r => r.json())
        .then(data => {
            if (!Array.isArray(data) || data.length === 0) return;

            const today = new Date();
            const seed = today.getFullYear() + today.getMonth() + today.getDate();
            const index = seed % data.length; 
            
            const currentMusic = data[index]; 
            musicData = currentMusic;

            document.getElementById('music-container').innerHTML = `
                <h2 style="margin:0 0 10px 0;">${currentMusic.titre} 
                    <div class="playing-animation"><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
                </h2>
                <div class="music-content-wrapper">
                    <img src="${currentMusic.image}" class="music-img" alt="Pochette">
                    <div class="music-info" style="text-align: left;">
                        <p style="color:var(--primary); font-weight:bold; margin:0;">
                            ${currentMusic.artiste} â€” ${currentMusic.album}
                        </p>
                        
                        <div style="font-size:0.9em; margin:10px 0; line-height: 1.5;">
                            <strong>Genre :</strong> ${currentMusic.genre}<br>
                            <strong>Format :</strong> ${currentMusic.format}<br>
                            <strong>Langue :</strong> ${currentMusic.langue}<br>
                            <strong>Sortie :</strong> ${currentMusic.date}
                        </div>
                        
                        <div class="history-wrapper">
                            <div id="music-history">
                                ${currentMusic.histoire}
                            </div>
                            <button class="toggle-history" onclick="toggleHistory()" id="btn-history">LIRE LA SUITE</button>
                        </div>
                    </div>
                </div>
            `;

            // Gestion du bouton YouTube
            const actionButtons = document.querySelector('.action-buttons');
            if (currentMusic.url) {
                const ytBtn = document.createElement('a');
                ytBtn.href = currentMusic.url;
                ytBtn.target = "_blank";
                ytBtn.className = "btn"; 
                ytBtn.style.backgroundColor = "#cc0000";
                ytBtn.style.color = "white";
                ytBtn.style.padding = "14px";
                ytBtn.style.marginBottom = "10px";
                ytBtn.style.fontSize = "0.9em";
                ytBtn.style.textDecoration = "none";
                ytBtn.innerHTML = "ðŸ“º Ã‰couter sur YouTube";
                actionButtons.insertBefore(ytBtn, actionButtons.firstChild);
            }
        });

    function toggleHistory() {
        const historyDiv = document.getElementById('music-history');
        const btn = document.getElementById('btn-history');
        if (historyDiv.classList.contains('expanded')) {
            historyDiv.classList.remove('expanded');
            btn.innerText = "LIRE LA SUITE";
        } else {
            historyDiv.classList.add('expanded');
            btn.innerText = "RÃ‰DUIRE";
        }
    }
</script>
</body>
</html>
